#include "common/StdMath.h"

// move 0.0f to the beginning of .sdata2
bool Orderfloats(float x) {
	return x < 0.0f;
}

float _sinTable[1025] = {
    0.0f,         0.0030679568f, 0.0061358847f, 0.009203754f,  0.012271538f,
    0.015339206f, 0.01840673f,   0.02147408f,   0.024541229f,  0.027608145f,
    0.030674804f, 0.033741172f,  0.036807224f,  0.039872926f,  0.04293826f,
    0.04600318f,  0.049067676f,  0.052131705f,  0.055195246f,  0.058258265f,
    0.061320737f, 0.06438263f,   0.06744392f,   0.070504576f,  0.07356457f,
    0.076623864f, 0.07968244f,   0.08274026f,   0.08579731f,   0.08885355f,
    0.091908954f, 0.0949635f,    0.09801714f,   0.10106986f,   0.10412163f,
    0.10717242f,  0.110222206f,  0.11327095f,   0.11631863f,   0.119365215f,
    0.12241068f,  0.12545498f,   0.1284981f,    0.13154003f,   0.1345807f,
    0.13762012f,  0.14065824f,   0.14369503f,   0.14673047f,   0.14976454f,
    0.15279719f,  0.1558284f,    0.15885815f,   0.1618864f,    0.16491312f,
    0.16793829f,  0.17096189f,   0.17398387f,   0.17700422f,   0.1800229f,
    0.18303989f,  0.18605515f,   0.18906866f,   0.1920804f,    0.19509032f,
    0.1980984f,   0.20110464f,   0.20410897f,   0.20711137f,   0.21011184f,
    0.21311031f,  0.2161068f,    0.21910124f,   0.22209363f,   0.22508392f,
    0.22807208f,  0.2310581f,    0.23404196f,   0.2370236f,    0.24000302f,
    0.24298018f,  0.24595505f,   0.24892761f,   0.2518978f,    0.25486565f,
    0.2578311f,   0.2607941f,    0.26375467f,   0.26671275f,   0.2696683f,
    0.27262136f,  0.27557182f,   0.2785197f,    0.28146493f,   0.28440753f,
    0.28734747f,  0.29028466f,   0.29321915f,   0.2961509f,    0.29907984f,
    0.30200595f,  0.30492923f,   0.30784965f,   0.31076714f,   0.31368175f,
    0.31659338f,  0.31950203f,   0.3224077f,    0.3253103f,    0.32820985f,
    0.3311063f,   0.33399966f,   0.33688986f,   0.33977687f,   0.34266073f,
    0.34554133f,  0.34841868f,   0.35129276f,   0.35416353f,   0.35703096f,
    0.35989505f,  0.36275572f,   0.36561298f,   0.36846682f,   0.3713172f,
    0.37416407f,  0.37700742f,   0.3798472f,    0.38268343f,   0.38551605f,
    0.38834503f,  0.39117038f,   0.39399204f,   0.39681f,      0.3996242f,
    0.40243465f,  0.4052413f,    0.40804416f,   0.41084316f,   0.41363832f,
    0.41642955f,  0.4192169f,    0.42200026f,   0.42477968f,   0.42755508f,
    0.4303265f,   0.43309382f,   0.4358571f,    0.43861625f,   0.44137126f,
    0.44412214f,  0.44686884f,   0.44961134f,   0.45234957f,   0.45508358f,
    0.4578133f,   0.46053872f,   0.4632598f,    0.4659765f,    0.46868882f,
    0.47139674f,  0.4741002f,    0.47679922f,   0.47949377f,   0.48218378f,
    0.48486924f,  0.48755017f,   0.49022648f,   0.4928982f,    0.49556527f,
    0.49822766f,  0.50088537f,   0.50353837f,   0.50618666f,   0.50883013f,
    0.5114688f,   0.51410276f,   0.5167318f,    0.519356f,     0.5219753f,
    0.52458966f,  0.52719915f,   0.52980363f,   0.5324031f,    0.53499764f,
    0.53758705f,  0.54017144f,   0.5427508f,    0.545325f,     0.54789406f,
    0.55045795f,  0.5530167f,    0.55557024f,   0.5581185f,    0.56066155f,
    0.56319934f,  0.5657318f,    0.56825894f,   0.57078075f,   0.57329714f,
    0.57580817f,  0.57831377f,   0.58081394f,   0.58330864f,   0.58579785f,
    0.5882816f,   0.5907597f,    0.5932323f,    0.5956993f,    0.5981607f,
    0.60061646f,  0.6030666f,    0.60551107f,   0.6079498f,    0.6103828f,
    0.6128101f,   0.6152316f,    0.6176473f,    0.6200572f,    0.62246126f,
    0.6248595f,   0.6272518f,    0.62963825f,   0.63201874f,   0.6343933f,
    0.63676184f,  0.63912445f,   0.64148104f,   0.64383155f,   0.64617604f,
    0.6485144f,   0.65084666f,   0.65317285f,   0.65549284f,   0.6578067f,
    0.66011435f,  0.6624158f,    0.664711f,     0.66699994f,   0.6692826f,
    0.671559f,    0.673829f,     0.6760927f,    0.67835003f,   0.680601f,
    0.68284553f,  0.6850837f,    0.68731534f,   0.68954057f,   0.6917592f,
    0.69397146f,  0.6961771f,    0.69837624f,   0.7005688f,    0.70275474f,
    0.70493406f,  0.70710677f,   0.7092728f,    0.7114322f,    0.71358484f,
    0.71573085f,  0.71787006f,   0.72000253f,   0.7221282f,    0.7242471f,
    0.7263591f,   0.72846437f,   0.73056275f,   0.7326543f,    0.7347389f,
    0.7368166f,   0.7388873f,    0.7409511f,    0.74300796f,   0.74505776f,
    0.7471006f,   0.7491364f,    0.75116515f,   0.7531868f,    0.7552014f,
    0.7572088f,   0.7592092f,    0.7612024f,    0.7631884f,    0.76516724f,
    0.7671389f,   0.76910335f,   0.7710605f,    0.77301043f,   0.7749531f,
    0.7768885f,   0.7788165f,    0.7807372f,    0.7826506f,    0.78455657f,
    0.7864552f,   0.7883464f,    0.7902302f,    0.79210657f,   0.7939755f,
    0.7958369f,   0.79769087f,   0.79953724f,   0.80137616f,   0.8032075f,
    0.80503136f,  0.8068476f,    0.80865616f,   0.81045717f,   0.8122506f,
    0.8140363f,   0.81581444f,   0.8175848f,    0.8193475f,    0.8211025f,
    0.8228498f,   0.8245893f,    0.82632107f,   0.82804507f,   0.8297612f,
    0.8314696f,   0.8331702f,    0.8348629f,    0.83654773f,   0.8382247f,
    0.8398938f,   0.841555f,     0.84320825f,   0.8448536f,    0.8464909f,
    0.84812033f,  0.84974176f,   0.8513552f,    0.8529606f,    0.854558f,
    0.85614735f,  0.8577286f,    0.8593018f,    0.86086696f,   0.86242396f,
    0.86397284f,  0.8655136f,    0.86704624f,   0.8685707f,    0.87008697f,
    0.8715951f,   0.873095f,     0.87458664f,   0.8760701f,    0.8775453f,
    0.8790122f,   0.8804709f,    0.8819213f,    0.88336337f,   0.8847971f,
    0.88622254f,  0.88763964f,   0.88904834f,   0.89044875f,   0.8918407f,
    0.8932243f,   0.8945995f,    0.89596623f,   0.89732456f,   0.8986745f,
    0.9000159f,   0.9013488f,    0.9026733f,    0.9039893f,    0.90529674f,
    0.9065957f,   0.9078861f,    0.909168f,     0.9104413f,    0.91170603f,
    0.9129622f,   0.9142098f,    0.9154487f,    0.9166791f,    0.9179008f,
    0.9191139f,   0.9203183f,    0.92151403f,   0.9227011f,    0.9238795f,
    0.92504925f,  0.9262102f,    0.9273625f,    0.9285061f,    0.9296409f,
    0.93076694f,  0.9318843f,    0.9329928f,    0.9340925f,    0.9351835f,
    0.93626565f,  0.937339f,     0.93840355f,   0.9394592f,    0.94050604f,
    0.94154406f,  0.9425732f,    0.94359344f,   0.9446048f,    0.9456073f,
    0.9466009f,   0.9475856f,    0.9485614f,    0.94952816f,   0.95048606f,
    0.951435f,    0.952375f,     0.953306f,     0.9542281f,    0.9551412f,
    0.95604527f,  0.95694035f,   0.95782644f,   0.95870346f,   0.95957154f,
    0.9604305f,   0.96128047f,   0.9621214f,    0.96295327f,   0.96377605f,
    0.9645898f,   0.96539444f,   0.96619f,      0.96697646f,   0.9677538f,
    0.9685221f,   0.96928126f,   0.97003126f,   0.97077215f,   0.9715039f,
    0.9722265f,   0.97293997f,   0.97364426f,   0.97433937f,   0.97502536f,
    0.9757021f,   0.97636974f,   0.97702813f,   0.97767735f,   0.9783174f,
    0.9789482f,   0.9795698f,    0.9801821f,    0.98078525f,   0.9813792f,
    0.9819639f,   0.9825393f,    0.9831055f,    0.9836624f,    0.9842101f,
    0.9847485f,   0.98527765f,   0.9857975f,    0.9863081f,    0.9868094f,
    0.9873014f,   0.98778415f,   0.9882576f,    0.98872167f,   0.9891765f,
    0.989622f,    0.9900582f,    0.9904851f,    0.99090266f,   0.99131083f,
    0.99170977f,  0.9920993f,    0.99247956f,   0.9928504f,    0.9932119f,
    0.9935641f,   0.993907f,     0.99424046f,   0.9945646f,    0.9948793f,
    0.9951847f,   0.9954808f,    0.9957674f,    0.9960447f,    0.9963126f,
    0.9965711f,   0.9968203f,    0.99706006f,   0.99729043f,   0.99751145f,
    0.99772304f,  0.9979253f,    0.9981181f,    0.99830157f,   0.99847555f,
    0.99864024f,  0.99879545f,   0.9989413f,    0.99907774f,   0.99920475f,
    0.99932235f,  0.9994306f,    0.9995294f,    0.9996188f,    0.9996988f,
    0.9997694f,   0.9998306f,    0.99988234f,   0.9999247f,    0.9999576f,
    0.99998116f,  0.9999953f,    1.0f,          0.9999953f,    0.99998116f,
    0.9999576f,   0.9999247f,    0.99988234f,   0.9998306f,    0.9997694f,
    0.9996988f,   0.9996188f,    0.9995294f,    0.9994306f,    0.99932235f,
    0.99920475f,  0.99907774f,   0.9989413f,    0.99879545f,   0.99864024f,
    0.99847555f,  0.99830157f,   0.9981181f,    0.9979253f,    0.99772304f,
    0.99751145f,  0.99729043f,   0.99706006f,   0.9968203f,    0.9965711f,
    0.9963126f,   0.9960447f,    0.9957674f,    0.9954808f,    0.9951847f,
    0.9948793f,   0.9945646f,    0.99424046f,   0.993907f,     0.9935641f,
    0.9932119f,   0.9928504f,    0.99247956f,   0.9920993f,    0.99170977f,
    0.99131083f,  0.99090266f,   0.9904851f,    0.9900582f,    0.989622f,
    0.9891765f,   0.98872167f,   0.9882576f,    0.98778415f,   0.9873014f,
    0.9868094f,   0.9863081f,    0.9857975f,    0.98527765f,   0.9847485f,
    0.9842101f,   0.9836624f,    0.9831055f,    0.9825393f,    0.9819639f,
    0.9813792f,   0.98078525f,   0.9801821f,    0.9795698f,    0.9789482f,
    0.9783174f,   0.97767735f,   0.97702813f,   0.97636974f,   0.9757021f,
    0.97502536f,  0.97433937f,   0.97364426f,   0.97293997f,   0.9722265f,
    0.9715039f,   0.97077215f,   0.97003126f,   0.96928126f,   0.9685221f,
    0.9677538f,   0.96697646f,   0.96619f,      0.96539444f,   0.9645898f,
    0.96377605f,  0.96295327f,   0.9621214f,    0.96128047f,   0.9604305f,
    0.95957154f,  0.95870346f,   0.95782644f,   0.95694035f,   0.95604527f,
    0.9551412f,   0.9542281f,    0.953306f,     0.952375f,     0.951435f,
    0.95048606f,  0.94952816f,   0.9485614f,    0.9475856f,    0.9466009f,
    0.9456073f,   0.9446048f,    0.94359344f,   0.9425732f,    0.94154406f,
    0.94050604f,  0.9394592f,    0.93840355f,   0.937339f,     0.93626565f,
    0.9351835f,   0.9340925f,    0.9329928f,    0.9318843f,    0.93076694f,
    0.9296409f,   0.9285061f,    0.9273625f,    0.9262102f,    0.92504925f,
    0.9238795f,   0.9227011f,    0.92151403f,   0.9203183f,    0.9191139f,
    0.9179008f,   0.9166791f,    0.9154487f,    0.9142098f,    0.9129622f,
    0.91170603f,  0.9104413f,    0.909168f,     0.9078861f,    0.9065957f,
    0.90529674f,  0.9039893f,    0.9026733f,    0.9013488f,    0.9000159f,
    0.8986745f,   0.89732456f,   0.89596623f,   0.8945995f,    0.8932243f,
    0.8918407f,   0.89044875f,   0.88904834f,   0.88763964f,   0.88622254f,
    0.8847971f,   0.88336337f,   0.8819213f,    0.8804709f,    0.8790122f,
    0.8775453f,   0.8760701f,    0.87458664f,   0.873095f,     0.8715951f,
    0.87008697f,  0.8685707f,    0.86704624f,   0.8655136f,    0.86397284f,
    0.86242396f,  0.86086696f,   0.8593018f,    0.8577286f,    0.85614735f,
    0.854558f,    0.8529606f,    0.8513552f,    0.84974176f,   0.84812033f,
    0.8464909f,   0.8448536f,    0.84320825f,   0.841555f,     0.8398938f,
    0.8382247f,   0.83654773f,   0.8348629f,    0.8331702f,    0.8314696f,
    0.8297612f,   0.82804507f,   0.82632107f,   0.8245893f,    0.8228498f,
    0.8211025f,   0.8193475f,    0.8175848f,    0.81581444f,   0.8140363f,
    0.8122506f,   0.81045717f,   0.80865616f,   0.8068476f,    0.80503136f,
    0.8032075f,   0.80137616f,   0.79953724f,   0.79769087f,   0.7958369f,
    0.7939755f,   0.79210657f,   0.7902302f,    0.7883464f,    0.7864552f,
    0.78455657f,  0.7826506f,    0.7807372f,    0.7788165f,    0.7768885f,
    0.7749531f,   0.77301043f,   0.7710605f,    0.76910335f,   0.7671389f,
    0.76516724f,  0.7631884f,    0.7612024f,    0.7592092f,    0.7572088f,
    0.7552014f,   0.7531868f,    0.75116515f,   0.7491364f,    0.7471006f,
    0.74505776f,  0.74300796f,   0.7409511f,    0.7388873f,    0.7368166f,
    0.7347389f,   0.7326543f,    0.73056275f,   0.72846437f,   0.7263591f,
    0.7242471f,   0.7221282f,    0.72000253f,   0.71787006f,   0.71573085f,
    0.71358484f,  0.7114322f,    0.7092728f,    0.70710677f,   0.70493406f,
    0.70275474f,  0.7005688f,    0.69837624f,   0.6961771f,    0.69397146f,
    0.6917592f,   0.68954057f,   0.68731534f,   0.6850837f,    0.68284553f,
    0.680601f,    0.67835003f,   0.6760927f,    0.673829f,     0.671559f,
    0.6692826f,   0.66699994f,   0.664711f,     0.6624158f,    0.66011435f,
    0.6578067f,   0.65549284f,   0.65317285f,   0.65084666f,   0.6485144f,
    0.64617604f,  0.64383155f,   0.64148104f,   0.63912445f,   0.63676184f,
    0.6343933f,   0.63201874f,   0.62963825f,   0.6272518f,    0.6248595f,
    0.62246126f,  0.6200572f,    0.6176473f,    0.6152316f,    0.6128101f,
    0.6103828f,   0.6079498f,    0.60551107f,   0.6030666f,    0.60061646f,
    0.5981607f,   0.5956993f,    0.5932323f,    0.5907597f,    0.5882816f,
    0.58579785f,  0.58330864f,   0.58081394f,   0.57831377f,   0.57580817f,
    0.57329714f,  0.57078075f,   0.56825894f,   0.5657318f,    0.56319934f,
    0.56066155f,  0.5581185f,    0.55557024f,   0.5530167f,    0.55045795f,
    0.54789406f,  0.545325f,     0.5427508f,    0.54017144f,   0.53758705f,
    0.53499764f,  0.5324031f,    0.52980363f,   0.52719915f,   0.52458966f,
    0.5219753f,   0.519356f,     0.5167318f,    0.51410276f,   0.5114688f,
    0.50883013f,  0.50618666f,   0.50353837f,   0.50088537f,   0.49822766f,
    0.49556527f,  0.4928982f,    0.49022648f,   0.48755017f,   0.48486924f,
    0.48218378f,  0.47949377f,   0.47679922f,   0.4741002f,    0.47139674f,
    0.46868882f,  0.4659765f,    0.4632598f,    0.46053872f,   0.4578133f,
    0.45508358f,  0.45234957f,   0.44961134f,   0.44686884f,   0.44412214f,
    0.44137126f,  0.43861625f,   0.4358571f,    0.43309382f,   0.4303265f,
    0.42755508f,  0.42477968f,   0.42200026f,   0.4192169f,    0.41642955f,
    0.41363832f,  0.41084316f,   0.40804416f,   0.4052413f,    0.40243465f,
    0.3996242f,   0.39681f,      0.39399204f,   0.39117038f,   0.38834503f,
    0.38551605f,  0.38268343f,   0.3798472f,    0.37700742f,   0.37416407f,
    0.3713172f,   0.36846682f,   0.36561298f,   0.36275572f,   0.35989505f,
    0.35703096f,  0.35416353f,   0.35129276f,   0.34841868f,   0.34554133f,
    0.34266073f,  0.33977687f,   0.33688986f,   0.33399966f,   0.3311063f,
    0.32820985f,  0.3253103f,    0.3224077f,    0.31950203f,   0.31659338f,
    0.31368175f,  0.31076714f,   0.30784965f,   0.30492923f,   0.30200595f,
    0.29907984f,  0.2961509f,    0.29321915f,   0.29028466f,   0.28734747f,
    0.28440753f,  0.28146493f,   0.2785197f,    0.27557182f,   0.27262136f,
    0.2696683f,   0.26671275f,   0.26375467f,   0.2607941f,    0.2578311f,
    0.25486565f,  0.2518978f,    0.24892761f,   0.24595505f,   0.24298018f,
    0.24000302f,  0.2370236f,    0.23404196f,   0.2310581f,    0.22807208f,
    0.22508392f,  0.22209363f,   0.21910124f,   0.2161068f,    0.21311031f,
    0.21011184f,  0.20711137f,   0.20410897f,   0.20110464f,   0.1980984f,
    0.19509032f,  0.1920804f,    0.18906866f,   0.18605515f,   0.18303989f,
    0.1800229f,   0.17700422f,   0.17398387f,   0.17096189f,   0.16793829f,
    0.16491312f,  0.1618864f,    0.15885815f,   0.1558284f,    0.15279719f,
    0.14976454f,  0.14673047f,   0.14369503f,   0.14065824f,   0.13762012f,
    0.1345807f,   0.13154003f,   0.1284981f,    0.12545498f,   0.12241068f,
    0.119365215f, 0.11631863f,   0.11327095f,   0.110222206f,  0.10717242f,
    0.10412163f,  0.10106986f,   0.09801714f,   0.0949635f,    0.091908954f,
    0.08885355f,  0.08579731f,   0.08274026f,   0.07968244f,   0.076623864f,
    0.07356457f,  0.070504576f,  0.06744392f,   0.06438263f,   0.061320737f,
    0.058258265f, 0.055195246f,  0.052131705f,  0.049067676f,  0.04600318f,
    0.04293826f,  0.039872926f,  0.036807224f,  0.033741172f,  0.030674804f,
    0.027608145f, 0.024541229f,  0.02147408f,   0.01840673f,   0.015339206f,
    0.012271538f, 0.009203754f,  0.0061358847f, 0.0030679568f, 0.0f
};

inline float GetFloat(int x) {
    return *(float*)&x;
}

inline int GetInt(float x) {
    return *(int*)&x;
}

// check param names
int RandomIR(int* pSeed, int min, int max) {
    int temp_r7;
    int curr;

    temp_r7 = max - min;
    if (temp_r7 <= 0) {
        return min;
    }
	// fix?
    curr = *pSeed = (*pSeed * 0x343FD) + 0x269EC3;
    curr = (curr >> 8) & 0xFFFFFF;
    return min + (curr % temp_r7);
}

int RandomI(int *pSeed) {
    int curr;
	// fix?
    curr = *pSeed = *pSeed * 0x343fd + 0x269ec3;
    return (curr >> 8) & 0xFFFFFF;
}

// uses a common union as _table_sinf?
float RandomFR(int* pSeed, float min, float max) {
    int sp8;
    int curr;

    curr = (*pSeed * 0x343FD) + 0x269EC3;
    *pSeed = curr;
    sp8 = ((curr >> 8U) & 0x7FFFFF) | 0x3F800000;
    float num = GetFloat(sp8) - 1.0f;
    return min + num * (max - min);
}

float _table_sinf(float arg0) {
    float sp8;
    float temp_f6;
    int temp_r5;
    int temp_r6;
    sindata data;
	
	// 1/2PI
    temp_r6 = 0.15915494f * (2048.0f * arg0);
    temp_r5 = temp_r6 & 0x3FF;
    temp_f6 = _sinTable[temp_r5];
    sp8 = temp_f6 + (325.94931f * (arg0 - (0.0030679617f * (f32)temp_r6)) * (_sinTable[temp_r5 + 1] - temp_f6));
    data.xf = sp8;
    data.xi |= ((temp_r6 << 0x15) & 0x80000000);
    return data.xf;
}

float NormaliseAngle(float angle) {
    float temp_f5;
    float var_f1;

    var_f1 = angle;
    temp_f5 = 6.2831855f; // define trig constants for entire file
    if (var_f1 >= temp_f5) {
        return var_f1 - (temp_f5 * (int)(0.15915494f * var_f1));
    }
    if (var_f1 < 0.0f) {
        var_f1 -= temp_f5 * (int)((0.15915494f * var_f1) - 1.0f);
        if (var_f1 == 6.2831855f) {
            var_f1 = 0.0f;
        }
    }
    return var_f1;
}